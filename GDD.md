# Archer vs Archer — Design Document

---

## 1. Overview

**Жанр:** 2D арена-шутер с элементами прокачки  
**Движок:** Ebiten (Go)  
**Платформа:** Web  

**Суть:**  
Игрок управляет лучником, стоящим на месте и стреляющим по врагу-лучнику.  
Механика стрельбы основана на натяжении тетивы по принципу *Angry Birds*:  
чем сильнее натянул, тем выше сила и дальность выстрела.  

Цель — уничтожать врагов, зарабатывать коины и усиливать персонажа в меню **«Персонаж»**.  
С каждым уровнем врагов больше и сильнее, но цикл бесконечен — игрок развивает персонажа до сколь угодно высокого уровня.

---

## 2. Core Gameplay Loop

1. Игрок открывает **главное меню**:
   - **Играть** — переход в бой.
   - **Персонаж** — просмотр характеристик и покупка улучшений.

2. **Бой:**
   - Игрок удерживает кнопку мыши (или пальцем на мобилке), натягивая тетиву.
   - Цвет индикатора силы натяжения меняется от зелёного к красному.
   - При отпускании — стрела летит по баллистике.
   - Враг стреляет в ответ, пристреливаясь с ошибками, постепенно повышая точность.
   - Попадания наносят урон в зависимости от части тела.

3. **После смерти врага:**
   - Через 2 секунды спавнится следующий.
   - За убийство врага +1 коин, за босса +10.
   - После убийства 15 врагов — уровень завершён, начинается следующий (на +10 врагов больше, максимум 45).

4. **Цикл бесконечен:**  
   после 45 врагов — повтор, но враги сильнее, награды выше.

5. **Вне боя:**  
   - Вкладка «Персонаж» — улучшения характеристик, покупка стрел и луков.

---

## 3. Systems

### 3.1. Стрельба
- Управление: натяжение по **длине вектора** между `BowPos` и позицией курсора.  
- Сила натяжения = `|vector| / MaxPull`, ограничено 1.0.  
- Скорость выстрела `v0 = PowerScale * |vector|`.  
- Траектория: простая баллистика с гравитацией `p(t) = p0 + v0*t + ½*g*t²`.  
- Цвет индикатора силы: зелёный → жёлтый → красный.  
- Стрела застревает в теле при попадании (не пробивает насквозь).

Параметры:
- MaxPull = 120 px
- PowerScale = 5.0
- Gravity = Vec2(0, 0.25)

### 3.2. Враги и AI
- Враги — лучники (аналог игрока, но управляемые ИИ).  
- Не двигаются, но «учатся» стрелять точнее:
  - первые выстрелы имеют случайное отклонение угла;
  - после 3–4 попыток начинают попадать в цель.  
- Враги могут иметь модификаторы:
  - `isBoss`: HP ×2, броня (damage absorb), усиленные стрелы.

Базовая структура (Go):

internal/domain/enemy.go

type Enemy struct {
    Pos          Vec2
    HP           float64
    Armor        float64
    Accuracy     float64
    LearnFactor  float64
    ArrowType    ArrowType
    IsBoss       bool
    Cooldown     time.Duration
    LastShotTime time.Time
}

### 3.3. Урон и хитбоксы

Части тела: Head, Torso, Arm, Leg.

Множители урона:

Часть	Множитель
Head	1.00
Torso	0.20
Arm	0.15
Leg	0.15

Каждая часть тела имеет свой хитбокс (CircleHitbox, AABBHitbox).

Попадание вычисляется через пересечение отрезка полёта стрелы с хитбоксами.

### 3.4. Прокачка и ресурсы

Характеристики игрока:

- Level — уровень персонажа.
- Stamina — HP.
- Agility — шанс крита (%).
- Strength — множитель урона при крите.

Формула опыта:

expNext = expPrev * 1.2
baseExp = 100
expPerKill = 10

Пример:
Уровень 1→2 = 100 XP, 2→3 = 120 XP, 3→4 = 144 XP и т.д.

### 3.5. Экономика

Коины — основная валюта, получаются за врагов:

- обычный: +1,
- босс: +10.

Кристаллы — редкая валюта (за победу над волной).

Покупки:

- улучшения лука (скорость натяжения, точность);
- стрелы (тип стрелы);
- визуальные скины (за кристаллы, в будущем).

3.6. Интерфейс

Главное меню:

Play
Character

Экран персонажа:

Отображает характеристики, валюту и улучшения.

Кнопки апгрейда.

В будущем — вкладка стрел и луков.

Игровой интерфейс:

- Индикатор силы выстрела (цвет).
- Счётчик врагов.
- Текущие коины.
- Здоровье игрока и врага.

## 4. Progression & Balance

Крит:
шанс = Agility%;
урон = BaseDamage * (1 + Strength).

HP врагов:
baseHP = 100
hpMultiplier = 1.15^(waveNumber - 1)

Урон стрелы:
damage = (Power * 0.8) + Random(0, Power*0.2)

Броня босса:
absorbed = min(damage * 0.3, Armor)
finalDamage = damage - absorbed
Armor -= absorbed

## 5. Technical Architecture (Ebiten)

Общая структура проекта

/cmd/game/main.go           — точка входа
/internal/
    domain/                 — бизнес-логика, модели
        archer.go
        enemy.go
        arrow.go
        physics.go
        hitbox.go
        experience.go
        shop.go
    app/                    — игровой процесс (циклы, сервисы)
        game_loop.go
        combat_service.go
        reward_service.go
        spawn_service.go
    ui/                     — интерфейс, отрисовка и ввод
        menu_scene.go
        game_scene.go
        character_scene.go
        hud.go
    assets/                 — изображения, шрифты, конфиги
        sprites/
        fonts/
        config/

#### domain

Чистая логика, без зависимостей от Ebiten.

archer.go
Archer — модель игрока: позиция, характеристики, методы Shoot(), TakeDamage().

enemy.go
AI-вражеская логика: UpdateAccuracy(), TryShoot().

physics.go
Векторная математика, интегратор баллистики.

hitbox.go
Формы хитбоксов, проверка пересечений.

shop.go
Модель предметов, апгрейдов, расчёт цен.

app

Управление игровым циклом, обработка логики, обращение к domain.

game_loop.go
Главный Update() и Draw(); контролирует состояние (Menu, Battle, Character).

combat_service.go
Контролирует бой: стрелы, столкновения, смерть врагов.

reward_service.go
Начисление XP и коины после убийства.

spawn_service.go
Управление спавном врагов, волнами и боссами.

ui

Работа с Ebiten API: ввод, вывод, визуализация.

menu_scene.go — кнопки «Играть» и «Персонаж».

game_scene.go — бой, рендер лука, стрел, врагов, эффекты.

character_scene.go — меню прокачки.

hud.go — индикаторы HP, сила выстрела, счётчики.

assets

Медиа и данные.

sprites/ — PNG спрайты персонажей, стрел, эффектов.
fonts/ — шрифт UI.
config/ — JSON файлы с параметрами (урон, множители, xp таблица).

## 6. Future Extensions

Новые стрелы:

- Fire: DoT-эффект;
- Frost: замедление врага;
- Triple: три стрелы под разными углами;
- Piercing: пробивает нескольких врагов.

Маги и классы врагов:

- Fire Mage (AoE атака);
- Shield Bearer (реген брони);
- Assassin (высокий крит).

Система эффектов:

EffectType (Burn, Slow, Freeze, Poison)
- хранится в domain/effect.go;
- интерфейс Apply(target *Archer).

Сохранения:

LocalStorage или JSON-файл (web build);

ключевые поля: уровень, коины, апгрейды.

Траектория предпросмотра:

- доступна за кристаллы;
- отрисовка точек полёта (предполагаемая траектория).

## 7. Основные параметры (черновой баланс)

| Параметр        | Значение     | Комментарий         |
| --------------- | ------------ | ------------------- |
| PlayerBaseHP    | 100          | Базовое здоровье    |
| EnemyBaseHP     | 100          | Первый враг         |
| Gravity         | 0.25         | Настройка физики    |
| CritChance      | 0.05         | Из ловкости         |
| CritMultiplier  | 1 + Strength | Урон крита          |
| BaseDamage      | 25           | Сила базовой стрелы |
| CoinPerKill     | 1            | Обычный враг        |
| CoinBoss        | 10           | Босс                |
| CrystalPerRound | 1            | За выигранную волну |
| ExpPerKill      | 10           | Базовый опыт        |
| ExpGrowth       | 1.2          | Рост XP на уровень  |
| WaveEnemies     | 15           | Начало              |
| WaveMax         | 45           | Предел              |

## 8. Итог

Archer vs Archer — цикличная 2D-аркада о дуэлях лучников,
ориентированная на развитие персонажа, простую баллистику и накапливаемую экономику.
Документ фиксирует все базовые системы, связи между ними и структуру репозитория.
Дальнейшие итерации пойдут от этого ядра: добавление эффектов, улучшение AI, визуала и мета-прогрессии.